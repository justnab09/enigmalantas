<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Traffic Signs Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        body {
            font-family: 'Press Start 2P', monospace;
            background: #000080;
            color: #ffffff;
            overflow: hidden;
        }

        .screen {
            width: 100vw;
            height: 100vh;
            display: none;
            position: absolute;
            top: 0;
            left: 0;
        }

        .screen.active {
            display: block;
        }

        /* Audio Controls */
        .audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .audio-toggle {
            width: 60px;
            height: 60px;
            border: 3px solid #ffffff;
            background: #000000;
            color: #ffffff;
            font-family: inherit;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .audio-toggle:hover {
            background: #333333;
            transform: scale(1.1);
        }

        .audio-toggle.muted {
            color: #ff0000;
            border-color: #ff0000;
        }

        /* Menu Screen */
        .menu-screen {
            background: #000080;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 40px;
            overflow-y: auto;
            min-height: 100vh;
        }

        .title {
            text-align: center;
            margin-bottom: 60px;
            font-size: 48px;
            line-height: 1.2;
            margin-top: 20px;
        }

        .title .line1 { color: #00ff00; }
        .title .line2 { color: #ffff00; }
        .title .line3 { color: #ff0000; }

        .menu-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 800px;
            width: 100%;
            margin-bottom: 40px;
        }

        .menu-btn {
            padding: 24px;
            font-family: inherit;
            font-size: 16px;
            font-weight: bold;
            border: 4px solid;
            background: #333333;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.1s;
            text-transform: uppercase;
        }

        .menu-btn:hover {
            background: #555555;
        }

        .menu-btn.green { 
            border-color: #00ff00; 
            color: #00ff00;
        }
        .menu-btn.yellow { 
            border-color: #ffff00; 
            color: #ffff00;
        }
        .menu-btn.red { 
            border-color: #ff0000; 
            color: #ff0000;
        }
        .menu-btn.blue { 
            border-color: #0080ff; 
            color: #0080ff;
        }
        .menu-btn.brown { 
            border-color: #ff8000; 
            color: #ff8000;
        }

        .menu-btn-subtitle {
            font-size: 12px;
            margin-top: 8px;
            opacity: 0.8;
        }

        /* Game Screen */
        .game-screen {
            background: #004080;
            position: relative;
        }

        .road {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: #404040;
            border-top: 4px solid #ffffff;
        }

        .road-lines {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 0;
            width: 200%;
            height: 8px;
            background: repeating-linear-gradient(
                90deg,
                transparent 0px,
                transparent 40px,
                #ffff00 40px,
                #ffff00 80px
            );
            animation: moveRoad 3s linear infinite;
        }

        @keyframes moveRoad {
            0% { transform: translateY(-50%) translateX(0); }
            100% { transform: translateY(-50%) translateX(-80px); }
        }

        .traffic-sign {
            position: absolute;
            right: -120px;
            top: 20%;
            width: 100px;
            height: 100px;
            background: #ffffff;
            border: 4px solid #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            animation: moveSign 2s ease-out forwards;
            z-index: 10;
            overflow: hidden;
        }

        .traffic-sign img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            image-rendering: pixelated;
        }

        @keyframes moveSign {
            0% { right: -120px; }
            100% { right: calc(100% + 120px); }
        }

        /* Game Header */
        .game-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 100px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .back-btn {
            padding: 12px 24px;
            font-family: inherit;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid #ffffff;
            background: #000000;
            color: #ffffff;
            cursor: pointer;
        }

        .back-btn:hover {
            background: #333333;
        }

        .category-display {
            padding: 12px 24px;
            border: 2px solid;
            background: #000000;
            font-weight: bold;
            font-size: 14px;
        }

        .category-display.green { border-color: #00ff00; color: #00ff00; }
        .category-display.yellow { border-color: #ffff00; color: #ffff00; }
        .category-display.red { border-color: #ff0000; color: #ff0000; }
        .category-display.blue { border-color: #0080ff; color: #0080ff; }
        .category-display.brown { border-color: #ff8000; color: #ff8000; }

        .game-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .question-counter {
            background: #000000;
            color: #ffff00;
            border: 2px solid #ffff00;
            padding: 12px 24px;
            font-weight: bold;
            font-size: 14px;
        }

        .timer {
            font-size: 24px;
            font-weight: bold;
            padding: 16px 24px;
            border: 2px solid;
            background: #000000;
            min-width: 80px;
            text-align: center;
        }

        .timer.normal {
            color: #00ff00;
            border-color: #00ff00;
        }

        .timer.warning {
            color: #ff0000;
            border-color: #ff0000;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        /* Question Panel */
        .question-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #000000;
            border: 4px solid #ffff00;
            padding: 32px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            display: none;
            z-index: 200;
        }

        .question-panel.show {
            display: block;
        }

        .question-progress {
            margin-bottom: 24px;
        }

        .question-number {
            color: #ffff00;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #333333;
            border: 2px solid #ffffff;
        }

        .progress-fill {
            height: 100%;
            background: #ffff00;
            transition: width 0.3s;
        }

        .sign-display {
            width: 120px;
            height: 120px;
            margin: 0 auto 24px;
            border: 4px solid #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            background: #ffffff;
            color: #000000;
            overflow: hidden;
        }

        .sign-display img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            image-rendering: pixelated;
        }

        .question-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 32px;
            color: #ffffff;
        }

        .answer-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .answer-btn {
            padding: 16px 24px;
            font-family: inherit;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid #ffffff;
            background: #333333;
            color: #ffffff;
            cursor: pointer;
            text-align: left;
            transition: all 0.1s;
        }

        .answer-btn:hover:not(:disabled) {
            background: #555555;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
        }

        .answer-btn.correct {
            background: #00ff00;
            border-color: #00ff00;
            color: #000000;
        }

        .answer-btn.wrong {
            background: #ff0000;
            border-color: #ff0000;
            color: #ffffff;
        }

        .answer-label {
            display: inline-block;
            width: 32px;
            height: 32px;
            background: #000000;
            color: #ffffff;
            text-align: center;
            line-height: 32px;
            margin-right: 16px;
            font-size: 14px;
            font-weight: bold;
        }

        /* Feedback Overlay */
        .feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .feedback-overlay.show {
            display: flex;
        }

        .feedback-overlay.correct {
            background: #00ff00;
        }

        .feedback-overlay.wrong {
            background: #ff0000;
        }

        .feedback-content {
            text-align: center;
            color: #000000;
        }

        .feedback-icon {
            font-size: 80px;
            margin-bottom: 16px;
        }

        .feedback-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .feedback-answer {
            font-size: 16px;
            font-weight: bold;
        }

        /* Result Panel */
        .result-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #000000;
            border: 4px solid;
            padding: 32px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            display: none;
            z-index: 200;
        }

        .result-panel.show {
            display: block;
        }

        .result-panel.win {
            border-color: #00ff00;
        }

        .result-panel.lose {
            border-color: #ff0000;
        }

        .result-icon {
            font-size: 80px;
            margin-bottom: 16px;
        }

        .result-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 32px;
        }

        .result-title.win {
            color: #00ff00;
        }

        .result-title.lose {
            color: #ff0000;
        }

        .result-stats {
            background: #333333;
            border: 2px solid #ffffff;
            padding: 24px;
            margin-bottom: 32px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-value.correct { color: #00ff00; }
        .stat-value.wrong { color: #ff0000; }
        .stat-value.percentage { color: #ffff00; }

        .stat-label {
            font-size: 12px;
            color: #ffffff;
            font-weight: bold;
        }

        .result-details {
            padding-top: 16px;
            border-top: 2px solid #ffffff;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            text-align: center;
        }

        .detail-value {
            font-size: 16px;
            font-weight: bold;
            color: #ffff00;
        }

        .detail-label {
            font-size: 10px;
            color: #ffffff;
            margin-top: 4px;
        }

        .performance-message {
            color: #ffffff;
            font-size: 14px;
            margin-bottom: 32px;
            line-height: 1.4;
        }

        .result-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .result-btn {
            padding: 16px 32px;
            font-family: inherit;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid;
            background: #333333;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.1s;
        }

        .result-btn.primary {
            border-color: #0080ff;
            color: #0080ff;
        }

        .result-btn.primary:hover {
            background: #555555;
        }

        .result-btn.secondary {
            border-color: #ffffff;
            color: #ffffff;
        }

        .result-btn.secondary:hover {
            background: #555555;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .title {
                font-size: 32px;
                margin-bottom: 40px;
            }

            .menu-buttons {
                grid-template-columns: 1fr;
                max-width: 400px;
            }

            .question-panel, .result-panel {
                width: 95%;
                padding: 24px;
            }

            .timer {
                font-size: 20px;
                padding: 12px 16px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .result-buttons {
                flex-direction: column;
            }

            .result-btn {
                width: 100%;
            }

            .menu-screen {
                padding: 20px;
                justify-content: flex-start;
            }

            .audio-toggle {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .game-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }

            .back-btn {
                align-self: flex-start;
            }

            .timer {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- Background Music - Kevin MacLeod Pixelland -->
    <audio id="backgroundMusic" loop preload="auto">
        <!-- Direct link to Kevin MacLeod - Pixelland (8-bit version) -->
        <source src="https://incompetech.com/music/royalty-free/mp3-royaltyfree/Pixelland.mp3" type="audio/mpeg">
        <!-- Alternative sources for better compatibility -->
        <source src="https://freemusicarchive.org/file/music/ccCommunity/Kevin_MacLeod/8_Bit_Dungeon_Level/Kevin_MacLeod_-_01_-_Pixelland.mp3" type="audio/mpeg">
        <!-- Fallback 8-bit style tracks -->
        <source src="https://www.soundjay.com/misc/sounds/magic-chime-02.wav" type="audio/wav">
        <source src="https://freesound.org/data/previews/316/316847_5123451-lq.mp3" type="audio/mpeg">
    </audio>

    <!-- Audio Controls -->
    <div class="audio-controls">
        <button class="audio-toggle" id="audioToggle" onclick="toggleAudio()">♪</button>
    </div>

    <div class="game-container">
        <!-- Menu Screen -->
        <div class="screen menu-screen active" id="menuScreen">
            <h1 class="title">
                <div class="line1">ENIGMA</div>
                <div class="line2">LANTAS</div>
            </h1>
            <div class="menu-buttons">
                <button class="menu-btn green" onclick="startGame('green')">
                    <div>RAMBU HIJAU</div>
                    <div class="menu-btn-subtitle">(PETUNJUK ARAH)</div>
                </button>
                <button class="menu-btn yellow" onclick="startGame('yellow')">
                    <div>RAMBU KUNING</div>
                    <div class="menu-btn-subtitle">(PERINGATAN)</div>
                </button>
                <button class="menu-btn red" onclick="startGame('red')">
                    <div>RAMBU MERAH</div>
                    <div class="menu-btn-subtitle">(LARANGAN)</div>
                </button>
                <button class="menu-btn blue" onclick="startGame('blue')">
                    <div>RAMBU BIRU</div>
                    <div class="menu-btn-subtitle">(PERINTAH)</div>
                </button>
                <button class="menu-btn brown" onclick="startGame('brown')">
                    <div>RAMBU COKELAT</div>
                    <div class="menu-btn-subtitle">(WISATA)</div>
                </button>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="screen game-screen" id="gameScreen">
            <div class="road">
                <div class="road-lines"></div>
                <div id="roadSigns"></div>
            </div>
            
            <div class="game-header">
                <button class="back-btn" onclick="backToMenu()">← MENU</button>
                <div class="category-display" id="categoryDisplay">RAMBU HIJAU</div>
                <div class="game-info">
                    <div class="question-counter" id="questionCounter">1/5</div>
                    <div class="timer normal" id="timer">10</div>
                </div>
            </div>
            
            <div class="question-panel" id="questionPanel">
                <div class="question-progress">
                    <div class="question-number" id="questionNumber">Soal 1 dari 5</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 20%"></div>
                    </div>
                </div>
                
                <div class="sign-display" id="signDisplay">🚗</div>
                <div class="question-text" id="questionText">Rambu ini menunjukkan?</div>
                <div class="answer-buttons" id="answerButtons">
                    <button class="answer-btn" onclick="selectAnswer(0)">
                        <span class="answer-label">A</span>
                        <span>Jawaban A</span>
                    </button>
                    <button class="answer-btn" onclick="selectAnswer(1)">
                        <span class="answer-label">B</span>
                        <span>Jawaban B</span>
                    </button>
                </div>
                
                <div class="feedback-overlay" id="feedbackOverlay">
                    <div class="feedback-content">
                        <div class="feedback-icon" id="feedbackIcon">✓</div>
                        <div class="feedback-title" id="feedbackTitle">BENAR!</div>
                        <div class="feedback-answer" id="feedbackAnswer"></div>
                    </div>
                </div>
            </div>

            <div class="result-panel" id="resultPanel">
                <div class="result-icon" id="resultIcon">🏆</div>
                <h2 class="result-title" id="resultTitle">SELAMAT!</h2>
                
                <div class="result-stats">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value correct" id="correctCount">5</div>
                            <div class="stat-label">JAWABAN BENAR</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value wrong" id="wrongCount">0</div>
                            <div class="stat-label">JAWABAN SALAH</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-value percentage" id="percentageScore">100%</div>
                        <div class="stat-label">SKOR</div>
                    </div>
                    
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="detail-value" id="totalTime">45 detik</div>
                            <div class="detail-label">TOTAL WAKTU</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value" id="categoryName">RAMBU HIJAU</div>
                            <div class="detail-label">KATEGORI</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-message" id="performanceMessage">
                    Luar biasa! Kamu sangat memahami rambu lalu lintas!
                </div>
                
                <div class="result-buttons">
                    <button class="result-btn primary" onclick="playAgain()">MAIN LAGI</button>
                    <button class="result-btn secondary" onclick="backToMenu()">MENU UTAMA</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Audio Management
        let backgroundMusic = document.getElementById('backgroundMusic');
        let isMuted = false;
        let hasInteracted = false;

        function initAudio() {
            if (!hasInteracted) {
                hasInteracted = true;
                backgroundMusic.volume = 0.4; // Set comfortable volume
                if (!isMuted) {
                    backgroundMusic.play().catch(e => {
                        console.log('Audio play failed:', e);
                        // Fallback: try to play after a short delay
                        setTimeout(() => {
                            backgroundMusic.play().catch(err => console.log('Retry failed:', err));
                        }, 1000);
                    });
                }
            }
        }

        function toggleAudio() {
            const audioToggle = document.getElementById('audioToggle');
            isMuted = !isMuted;
            
            if (!hasInteracted) {
                initAudio();
            }
            
            if (isMuted) {
                audioToggle.textContent = '♪̸';
                audioToggle.classList.add('muted');
                backgroundMusic.pause();
            } else {
                audioToggle.textContent = '♪';
                audioToggle.classList.remove('muted');
                backgroundMusic.play().catch(e => console.log('Audio play failed:', e));
            }
        }

        // Initialize audio on first user interaction
        document.addEventListener('click', initAudio, { once: true });
        document.addEventListener('keydown', initAudio, { once: true });

        // Game data 
        const signData = {
            green: [
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759788/bandara_qixepv.jpg", 
                    question: "Rambu ini adalah?", 
                    answers: ["Bandara", "Stasiun"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/bogor_snexws.png", 
                    question: "Bogor ke arah?", 
                    answers: ["Kanan", "Lurus"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759789/bekasi_twtk4a.png", 
                    question: "Bekasi ke arah?", 
                    answers: ["Lurus", "Kiri"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/exit_iihxi4.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Exit", "Entrance"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759797/magelang_n0syi4.png", 
                    question: "Magelang ke arah?", 
                    answers: ["Kanan", "Kiri"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759798/meetingpoint_qheuvw.jpg", 
                    question: "Rambu ini adalah?", 
                    answers: ["Titik Kumpul", "Parkir"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759803/terminalbaranangsiang_rgx6y8.png", 
                    question: "Berapa jarak ke Terminal?", 
                    answers: ["7 km", "17 km"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759810/ujungpandang_jc2ygs.png", 
                    question: "Berapa jarak ke Ujung Pandang?", 
                    answers: ["30 km", "3 km"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759802/semarang_jf52wg.png", 
                    question: "Semarang ke arah?", 
                    answers: ["Kiri", "Kanan"], 
                    correct: 0 
                },
            ],
            yellow: [
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759791/gelombang_jfhdil.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Jalan Bergelombang", "Jalan Bebatuan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/cekungan_wodenx.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Jalan Cekung", "Jalan Cembung"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/cembung_kxudjk.jpg", 
                    question: "Rambu ini adalah?", 
                    answers: ["Jalan Cembung", "Jalan Cekung"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759794/jembatan_jpltkb.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Jembatan", "Penyempitan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759795/licin_rhgxei.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Jalan Licin", "Jalan Tikung"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759795/longsor_cnzwvn.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Longsor", "Batuan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759798/menurun_ofjfmi.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Jalan Menurun", "Jalan ke Bawah"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759799/penyempitan_hyjiuc.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Penyempitan Jalan", "Jembatan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759802/penyempitanjalanankanan_wrhoej.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Penyempitan Jalan ke Kanan", "Penyempitan Jalan ke Kiri"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759805/tikungan_memutar_wkqp8z.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Tikungan Memutar", "Bundaran"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759806/tikunganganda_jo4wjx.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Tikungan Ganda", "Tikungan Tajam"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759807/tikungankekanan_biocsm.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Tikungan ke Kanan", "Tikungan ke Kiri"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759807/tikungankekiri_pq3riz.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Tikungan ke Kiri", "Tikungan ke kanan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759807/tikungantajam_ciqylj.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Tikungan Tajam", "Tikungan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759810/tikungantajamganda_a0ldrs.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Tikungan Tajam Ganda", "Tikungan Tajam"], 
                    correct: 0 
                },
            ],
            red: [
               { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759789/batasjarakantarkendaraan_uvc8i6.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Batas Jarak Antar Kendaraan", "Tempat Parkir"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759789/bataskecepatan_yl6gby.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Batas Kecepatan", "Lebih Cepat"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759789/batasketinggian_vmxys5.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Batas Ketinggian", "Batas Ruang Lebar"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/batasruanglebar_qsgdn3.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Batas Ruang Lebar", "Batas Ketinggian"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759789/bataston_ljkj3q.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Batas Tonase", "Batas Ketinggian"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/dilarangberhenti_qhtcef.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Dilarang Berhenti", "Berhenti"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/dilarangmasuk_kskuxd.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Dilarang Masuk", "Masuk"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/dilarangparkir_ljdjbo.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Dilarang Parkir", "Parkir"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759795/kendaraanbermotordilarangmasuk_req890.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Kendaraan Bermotor Dilarang Masuk", "Motor Dilarang Masuk"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759795/khususpanjangtruktertentu_bt6clg.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Khusus Panjang Truk Tertentu", "Khusus Lebar Truk Tertentu"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759798/mobildilarangmasuk_idpkbn.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Mobil Dilarang Masuk", "Motor Dilarang Masuk"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759798/motordilarangmasuk_rzget4.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Motor Dilarang Masuk", "Mobil Dilarang Masuk"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759802/sepedadilarangmasuk_vtljhm.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Sepeda Dilarang Masuk", "Jalur Khusus Sepeda"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759789/batastonmuatan_k2aic2.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Batas Tonase Muatan", "Batas Tonase"], 
                    correct: 0 
                },
            ],
            blue: [
                 { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759788/bagianjalanyangwajibdilewati_buyxrg.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Bagian Jalan yang Wajib Dilewati", "Dilarang Masuk"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759789/bataskecepatanakhirminimum_cbyex8.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Batas Kecepatan Akhir Minimum", "Batas Minimum Kecepatan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759794/jalurkhusussepeda_rzvlo5.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Jalur Khusus Sepeda", "Sepeda Dilarang Masuk"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759802/perintahkecepatanminimum_y83wrb.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Perintah Kecepatan Minimum", "Batas Kecepatan Maksimum"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759811/wajibkearahkanan_sgwgg7.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Wajib ke Arah Kanan", "Wajib ke Arah kiri"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759811/wajibkearahkiri_l3cgpk.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Wajib ke Arah Kiri", "Wajib ke Arah Kanan"], 
                    correct: 0 
                },
                 { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759811/wajibkearahyangditunjuk_luj0z1.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Wajib ke Arah yang Ditunjuk", "Dilarang ke Arah yang Ditunjuk"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759814/wajiblurus_mefko6.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Wajib Lurus", " Dilarang Lurus"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759814/wajibmengikutiarahbundaran_qvhtcg.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Wajib Mengikuti Arah Bundaran", "Putar Balik"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759814/wajibmengikutisalahsatuarah_jpgv24.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Wajib Mengikuti Salah Satu Arah", "Belok ke Kiri"], 
                    correct: 0 
                },
            ],
            brown: [
               { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759790/buper_crzowi.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Di Jarak 500 meter Ada Bumi Perkemahan", "Di Jarak 500 meter Ada Gunung"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759794/kebunrayabogor_oed3b3.png", 
                    question: "Rambu ini adalah?", 
                    answers: ["Ada Kebun Raya Bogor", "Ada Hutan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759799/palangcoklat_ystjlm.png", 
                    question: "Apa Makna Rambu Coklat?", 
                    answers: ["Rambu Penunjuk Lokasi/Wisata", "Rambu Peringatan"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759802/tamansafari_wv0ww8.png", 
                    question: "Mana yang Rambu Penunjuk Lokasi/Wisata?", 
                    answers: ["Taman Safari, Puncak", "Bandung"], 
                    correct: 0 
                },
                { 
                    image: "https://res.cloudinary.com/dgqciq92c/image/upload/v1750759803/tangkubanperahu_j6ofn4.png", 
                    question: "Ada Apa di jarak 10 km?", 
                    answers: ["Tangkuban Perahu", "Gunung Ungaran"], 
                    correct: 0 
                },
            ],
        };

        // Game state
        let currentCategory = '';
        let currentQuestions = [];
        let currentQuestion = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let timeLeft = 10;
        let questionTimer;
        let startTime;
        let shuffledAnswers = [];
        let newCorrectIndex = 0;

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Function to shuffle answers and track new correct position
        function shuffleAnswers(question) {
            const correctAnswer = question.answers[question.correct];
            const answersWithIndex = question.answers.map((answer, index) => ({
                text: answer,
                isCorrect: index === question.correct
            }));
            
            const shuffled = shuffleArray(answersWithIndex);
            shuffledAnswers = shuffled.map(item => item.text);
            newCorrectIndex = shuffled.findIndex(item => item.isCorrect);
            
            return {
                shuffledAnswers,
                newCorrectIndex
            };
        }

        function resetGame() {
            currentQuestion = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            clearInterval(questionTimer);
            
            // Hide panels
            document.getElementById('questionPanel').classList.remove('show');
            document.getElementById('resultPanel').classList.remove('show');
            document.getElementById('feedbackOverlay').classList.remove('show');
            
            // Clear road signs
            const roadSigns = document.getElementById('roadSigns');
            if (roadSigns) roadSigns.innerHTML = '';
        }

        function startGame(category) {
            currentCategory = category;
            resetGame();
            startTime = Date.now();
            
            // Ensure audio is initialized when game starts
            if (!hasInteracted) {
                initAudio();
            }
           
            // Select 5 random questions
            const allQuestions = signData[category];
            currentQuestions = shuffleArray(allQuestions).slice(0, 5);
           
            showScreen('gameScreen');
            updateCategoryDisplay(category);
           
            // Start first question
            setTimeout(() => {
                showNextQuestion();
            }, 1000);
        }

        function updateCategoryDisplay(category) {
            const categoryDisplay = document.getElementById('categoryDisplay');
            const categoryNames = {
                'green': 'RAMBU HIJAU',
                'yellow': 'RAMBU KUNING',
                'red': 'RAMBU MERAH',
                'blue': 'RAMBU BIRU',
                'brown': 'RAMBU COKELAT'
            };
            
            categoryDisplay.textContent = categoryNames[category];
            categoryDisplay.className = `category-display ${category}`;
        }

        function showNextQuestion() {
            if (currentQuestion >= 5) {
                endGame();
                return;
            }

            const question = currentQuestions[currentQuestion];
            
            // Create traffic sign animation
            createTrafficSign(question);
            
            // Update UI
            updateGameUI();
            
            // Show question after sign animation
            setTimeout(() => {
                showQuestionPanel(question);
            }, 2000);
        }

        function createTrafficSign(question) {
    const roadSigns = document.getElementById('roadSigns');
    if (!roadSigns) return;
    
    const sign = document.createElement('div');
    sign.className = 'traffic-sign';
    
    // GANTI SEMUA BLOK INI dengan:
    if (question.image) {
        const img = document.createElement('img');
        img.src = question.image;
        img.alt = 'Traffic Sign';
        sign.appendChild(img);
    } else {
        sign.textContent = question.symbol || '?';
    }
    
    roadSigns.appendChild(sign);

            roadSigns.appendChild(sign);
            
            // Remove sign after animation
            setTimeout(() => {
                if (sign.parentNode) {
                    sign.parentNode.removeChild(sign);
                }
            }, 2500);
        }

        function updateGameUI() {
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/5`;
            document.getElementById('questionNumber').textContent = `Soal ${currentQuestion + 1} dari 5`;
            document.getElementById('progressFill').style.width = `${((currentQuestion + 1) / 5) * 100}%`;
        }

       function showQuestionPanel(question) {
    const { shuffledAnswers: answers, newCorrectIndex: correctIndex } = shuffleAnswers(question);
    const signDisplay = document.getElementById('signDisplay');
    
    if (question.image) {
        signDisplay.innerHTML = `<img src="${question.image}" alt="Traffic Sign">`;
    } else {
        signDisplay.textContent = question.symbol || '?';
    }
    
            document.getElementById('questionText').textContent = question.question;
            
            // Update answer buttons with shuffled answers
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach((btn, index) => {
                btn.disabled = false;
                btn.className = 'answer-btn';
                btn.querySelector('span:last-child').textContent = answers[index];
            });
            
            // Store the new correct index
            newCorrectIndex = correctIndex;
            
            // Show panel
            document.getElementById('questionPanel').classList.add('show');
           
            // Start timer
            startQuestionTimer();
        }

        function startQuestionTimer() {
            timeLeft = 10;
            updateTimer();
            
            questionTimer = setInterval(() => {
                timeLeft--;
                updateTimer();
                
                if (timeLeft <= 0) {
                    clearInterval(questionTimer);
                    selectAnswer(-1); // Time's up
                }
            }, 1000);
        }

        function updateTimer() {
            const timerEl = document.getElementById('timer');
            if (timerEl) {
                timerEl.textContent = timeLeft.toString().padStart(2, '0');
                
                // Update timer appearance based on time left
                if (timeLeft <= 3) {
                    timerEl.className = 'timer warning';
                } else {
                    timerEl.className = 'timer normal';
                }
            }
        }

        function selectAnswer(answerIndex) {
            if (questionTimer) {
                clearInterval(questionTimer);
            }
           
            const question = currentQuestions[currentQuestion];
            const isCorrect = answerIndex === newCorrectIndex;
            const isTimeout = answerIndex === -1;
            
            // Disable all buttons
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.disabled = true);
            
            if (!isTimeout) {
                // Highlight selected answer
                buttons[answerIndex].classList.add(isCorrect ? 'correct' : 'wrong');
                
                // Show correct answer if wrong
                if (!isCorrect) {
                    buttons[newCorrectIndex].classList.add('correct');
                }
            } else {
                // Show correct answer on timeout
                buttons[newCorrectIndex].classList.add('correct');
            }
            
            // Update score
            if (isCorrect) {
                correctAnswers++;
            } else {
                wrongAnswers++;
            }
            
            // Show feedback
            showFeedback(isCorrect, isTimeout, question);
        }

        function showFeedback(isCorrect, isTimeout, question) {
            const overlay = document.getElementById('feedbackOverlay');
            const icon = document.getElementById('feedbackIcon');
            const title = document.getElementById('feedbackTitle');
            const answer = document.getElementById('feedbackAnswer');
            
            const correctAnswerText = shuffledAnswers[newCorrectIndex];
            
            if (isTimeout) {
                overlay.className = 'feedback-overlay wrong show';
                icon.textContent = '⏰';
                title.textContent = 'WAKTU HABIS!';
                answer.textContent = `Jawaban: ${correctAnswerText}`;
            } else if (isCorrect) {
                overlay.className = 'feedback-overlay correct show';
                icon.textContent = '✓';
                title.textContent = 'BENAR!';
                answer.textContent = '';
            } else {
                overlay.className = 'feedback-overlay wrong show';
                icon.textContent = '✗';
                title.textContent = 'SALAH!';
                answer.textContent = `Jawaban: ${correctAnswerText}`;
            }
            
            // Hide feedback and continue after delay
            setTimeout(() => {
                overlay.classList.remove('show');
                document.getElementById('questionPanel').classList.remove('show');
                currentQuestion++;
                
                setTimeout(() => {
                    showNextQuestion();
                }, 500);
            }, 2000);
        }

        function endGame() {
            const totalTime = Math.floor((Date.now() - startTime) / 1000);
            const percentage = Math.round((correctAnswers / 5) * 100);
            const isWin = correctAnswers >= 3;
            
            // Update result panel
            const resultPanel = document.getElementById('resultPanel');
            const resultIcon = document.getElementById('resultIcon');
            const resultTitle = document.getElementById('resultTitle');
            
            resultPanel.className = `result-panel ${isWin ? 'win' : 'lose'} show`;
            resultIcon.textContent = isWin ? '🏆' : '💪';
            resultTitle.textContent = isWin ? 'SELAMAT!' : 'COBA LAGI!';
            resultTitle.className = `result-title ${isWin ? 'win' : 'lose'}`;
            
            // Update statistics
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('wrongCount').textContent = wrongAnswers;
            document.getElementById('percentageScore').textContent = percentage + '%';
            document.getElementById('totalTime').textContent = totalTime + ' detik';
            document.getElementById('categoryName').textContent = getCategoryName(currentCategory);
            
            // Update performance message
            const performanceMessage = document.getElementById('performanceMessage');
            if (percentage >= 80) {
                performanceMessage.textContent = 'Luar biasa! Kamu sangat memahami rambu lalu lintas!';
            } else if (percentage >= 60) {
                performanceMessage.textContent = 'Bagus! Kamu cukup memahami rambu lalu lintas.';
            } else if (percentage >= 40) {
                performanceMessage.textContent = 'Tidak buruk! Terus belajar untuk hasil yang lebih baik.';
            } else {
                performanceMessage.textContent = 'Jangan menyerah! Pelajari lebih banyak tentang rambu lalu lintas.';
            }
        }

        function getCategoryName(category) {
            const names = {
                'green': 'RAMBU HIJAU',
                'yellow': 'RAMBU KUNING', 
                'red': 'RAMBU MERAH',
                'blue': 'RAMBU BIRU',
                'brown': 'RAMBU COKELAT'
            };
            return names[category] || 'UNKNOWN';
        }

        function playAgain() {
            if (currentCategory) {
                startGame(currentCategory);
            }
        }

        function backToMenu() {
            resetGame();
            showScreen('menuScreen');
        }

        // Initialize the game
        showScreen('menuScreen');
        
        // Set initial volume for background music
        backgroundMusic.volume = 0.4;
    </script>
</body>
</html>

